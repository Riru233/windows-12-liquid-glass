<template>
  <div class="control-container" @mouseup="stopDrag" @mouseleave="stopDrag">
    <!-- 第一层：状态 -->
    <div style="width: calc(100% - 30px); margin: 15px 0 0 15px; display: flex">
      <!-- 电池状态 -->
      <TopButton :width="80" :height="32" :radius="16">
        <svg
          class="icon"
          style="
            width: 20px;
            height: 20px;
            vertical-align: middle;
            fill: currentColor;
            overflow: hidden;
          "
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="18102"
        >
          <path
            d="M725.333333 256a128 128 0 0 1 128 128v42.666667h42.666667a42.666667 42.666667 0 0 1 42.666667 42.666666v85.333334a42.666667 42.666667 0 0 1-42.666667 42.666666h-42.666667v42.666667a128 128 0 0 1-128 128H213.333333a128 128 0 0 1-128-128V384a128 128 0 0 1 128-128h512z m-0.085333 64H213.333333a64 64 0 0 0-63.744 57.856L149.333333 384v256a64 64 0 0 0 57.813334 63.701333L213.333333 704h511.914667a64 64 0 0 0 63.701333-57.813333l0.298667-6.186667V384a64 64 0 0 0-57.813333-63.701333l-6.186667-0.298667zM256 384h426.666667a42.666667 42.666667 0 0 1 42.368 37.674667L725.333333 426.666667v170.666666a42.666667 42.666667 0 0 1-37.674666 42.368L682.666667 640H256a42.666667 42.666667 0 0 1-42.368-37.674667L213.333333 597.333333v-170.666666a42.666667 42.666667 0 0 1 37.674667-42.368L256 384h426.666667H256z"
            p-id="18136"
          ></path>
        </svg>
        <div style="font-size: 12px">100%</div>
      </TopButton>
      <div style="flex-grow: 1"></div>
      <TopButton :width="60" :height="32" :radius="16">
        <svg
          class="icon"
          style="
            width: 13px;
            height: 13px;
            vertical-align: middle;
            fill: currentColor;
            overflow: hidden;
          "
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="36396"
        >
          <path
            d="M170.666667 512a341.333333 341.333333 0 1 1 682.666666 0 341.333333 341.333333 0 0 1-682.666666 0z"
            p-id="36397"
          ></path>
        </svg>
        <svg
          class="icon"
          style="
            width: 11px;
            height: 11px;
            opacity: 0.6;
            vertical-align: middle;
            fill: currentColor;
            overflow: hidden;
          "
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="36396"
        >
          <path
            d="M170.666667 512a341.333333 341.333333 0 1 1 682.666666 0 341.333333 341.333333 0 0 1-682.666666 0z"
            p-id="36397"
          ></path>
        </svg>
        <svg
          class="icon"
          style="
            width: 13px;
            height: 13px;
            vertical-align: middle;
            fill: currentColor;
            overflow: hidden;
          "
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="38405"
        >
          <path
            d="M275.692308 860.553846V163.446154c0-19.692308 25.6-33.476923 43.323077-17.723077l417.476923 340.676923c15.753846 11.815385 15.753846 37.415385 0 49.230769L319.015385 880.246154c-17.723077 13.784615-43.323077 1.969231-43.323077-19.692308z"
            p-id="38406"
          ></path>
        </svg>
      </TopButton>
      <div style="flex-grow: 1.2"></div>
      <TopButton :width="32" :height="32" :radius="16">
        <svg
          class="icon"
          style="
            width: 20px;
            height: 20px;
            vertical-align: middle;
            fill: #333;
            overflow: hidden;
          "
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="18025"
        >
          <path
            d="M512.512 96c31.317333 0.341333 62.506667 3.968 93.098667 10.794667a32 32 0 0 1 24.832 27.690666l7.253333 65.152a59.050667 59.050667 0 0 0 82.218667 47.616l59.776-26.24a32 32 0 0 1 36.266666 7.424 417.792 417.792 0 0 1 94.037334 161.792 32 32 0 0 1-11.562667 35.2l-52.992 39.082667a58.922667 58.922667 0 0 0 0 94.976l53.034667 39.04a32 32 0 0 1 11.605333 35.242667 418.005333 418.005333 0 0 1-94.037333 161.792 32 32 0 0 1-36.181334 7.466666l-60.032-26.325333a58.88 58.88 0 0 0-82.176 47.530667l-7.210666 65.109333a32 32 0 0 1-24.405334 27.605333 406.101333 406.101333 0 0 1-187.989333 0 32 32 0 0 1-24.405333-27.605333l-7.168-65.024a58.965333 58.965333 0 0 0-82.176-47.36l-59.989334 26.282667a32 32 0 0 1-36.224-7.466667 418.048 418.048 0 0 1-94.037333-161.962667 32 32 0 0 1 11.605333-35.242666l53.034667-39.082667a58.88 58.88 0 0 0 0-94.976l-53.034667-38.997333a32 32 0 0 1-11.562666-35.242667 417.834667 417.834667 0 0 1 94.037333-161.792 32 32 0 0 1 36.266667-7.424l59.733333 26.24a59.178667 59.178667 0 0 0 82.346667-47.701333l7.253333-65.109334a32 32 0 0 1 24.874667-27.733333c30.592-6.784 61.866667-10.368 93.909333-10.752z m0 64a389.76 389.76 0 0 0-57.770667 4.992l-4.650666 41.685333A123.136 123.136 0 0 1 278.4 305.92l-38.314667-16.810667a353.834667 353.834667 0 0 0-57.514666 98.858667l34.048 25.045333a122.922667 122.922667 0 0 1 0 198.101334l-34.090667 25.088c13.653333 35.925333 33.109333 69.376 57.514667 99.072l38.613333-16.938667a122.965333 122.965333 0 0 1 171.392 98.901333l4.693333 41.984c37.930667 6.4 76.714667 6.4 114.645334 0l4.693333-41.984a122.922667 122.922667 0 0 1 171.434667-99.072l38.613333 16.896a353.962667 353.962667 0 0 0 57.472-98.901333l-34.048-25.088a122.922667 122.922667 0 0 1 0-198.101333l33.962667-25.045334a353.834667 353.834667 0 0 0-57.514667-98.858666l-38.229333 16.768a123.050667 123.050667 0 0 1-171.648-99.157334l-4.693334-41.642666a383.488 383.488 0 0 0-56.874666-4.992zM512 352a160 160 0 1 1 0 320 160 160 0 0 1 0-320z m0 64a96 96 0 1 0 0 192 96 96 0 0 0 0-192z"
            p-id="18026"
          ></path>
        </svg>
      </TopButton>
    </div>
    <!-- 第二层：控制按钮 -->
    <div class="six-flex">
      <!-- wifi -->
      <ControlButton :selected="true" title="Wi-Fi">
        <path
          d="M757.12 458.666667a353.749333 353.749333 0 0 1 63.658667 88.32 32 32 0 1 1-56.96 29.141333 290.048 290.048 0 0 0-51.968-72.192 279.978667 279.978667 0 0 0-447.701334 71.381333 32 32 0 1 1-57.130666-28.885333 343.978667 343.978667 0 0 1 550.101333-87.765333z m-89.685333 130.986666c19.114667 19.072 34.816 42.538667 45.738666 67.498667a32 32 0 1 1-58.581333 25.685333 158.72 158.72 0 0 0-32.426667-47.957333 153.258667 153.258667 0 0 0-216.746666 0c-13.226667 13.226667-23.978667 29.397333-31.829334 47.36a32 32 0 1 1-58.666666-25.6 218.026667 218.026667 0 0 1 45.269333-66.986667 217.258667 217.258667 0 0 1 307.242667 0z m205.013333-236.416c21.76 21.717333 42.24 46.506667 60.117333 72.405334a32 32 0 0 1-52.693333 36.352 461.738667 461.738667 0 0 0-52.650667-63.530667c-174.08-174.08-456.32-174.08-630.442666 0-17.962667 18.005333-35.84 39.850667-52.138667 63.317333a32 32 0 0 1-52.565333-36.48c18.346667-26.453333 38.613333-51.2 59.477333-72.106666 199.082667-199.04 521.813333-199.04 720.896 0z m-315.178667 348.16a64 64 0 1 1-90.538666 90.538667 64 64 0 0 1 90.538666-90.538667z"
          p-id="16976"
        ></path>
      </ControlButton>
      <!-- bluetooth -->
      <ControlButton title="Disconnected">
        <path
          d="M499.114667 553.557333l114.432 95.445334-122.709334 132.992v-221.568l8.277334-6.869334z m49.962666-41.642666l131.285334-109.397334a32 32 0 0 0 3.029333-46.293333l-201.002667-217.770667a32 32 0 0 0-55.552 21.674667v249.813333l-47.786666-39.850666a32 32 0 1 0-40.96 49.152l88.746666 74.026666v37.162667l-88.746666 73.984a32 32 0 0 0 40.96 49.152l47.786666-39.850667v250.154667a32 32 0 0 0 55.552 21.674667l201.002667-217.856a32 32 0 0 0-2.986667-46.293334l-131.328-109.482666z m-49.92-41.685334l-8.32-6.912V242.005333l122.709334 132.906667-114.432 95.317333z"
          p-id="17280"
        ></path>
      </ControlButton>
      <!-- flight -->
      <ControlButton title="Flight Mode">
        <path
          d="M404.053333 411.434667L374.101333 160.853333l-0.085333-3.157333c0-37.930667 30.72-68.693333 68.693333-68.693333 34.218667 0 65.92 17.92 84.352 48.426666l3.712 6.869334 125.653334 259.84 168.832-4.992a110.933333 110.933333 0 0 1 114.005333 107.946666l0.042667 2.816a111.018667 111.018667 0 0 1-111.786667 110.805334l-169.088-4.949334-127.658667 264.021334a97.834667 97.834667 0 0 1-88.106666 55.253333c-37.930667 0-68.650667-30.72-68.650667-69.589333l0.298667-5.034667 30.165333-252.074667-90.965333-2.688-11.52 31.402667a83.029333 83.029333 0 0 1-77.952 54.528c-37.376 0-67.669333-30.293333-67.669334-67.712v-32.426667l-6.570666-1.365333a81.92 81.92 0 0 1 0-160.341333l6.613333-1.365334v-32.426666c0-34.261333 25.472-62.933333 61.184-67.370667l6.442667-0.341333c31.786667 0 60.714667 18.176 75.306666 48.085333l2.688 6.4 11.52 31.402667 90.453334-2.645334z m38.656-258.432c-2.56 0-4.650667 2.090667-4.693333 3.712l37.845333 316.672-206.506666 6.016-26.794667-73.173334-1.365333-3.370666c-3.2-6.485333-9.813333-10.666667-15.104-10.709334l-2.474667 0.085334a3.669333 3.669333 0 0 0-3.2 3.626666l0.042667 84.48-57.6 12.032a17.877333 17.877333 0 0 0 0 35.029334l57.6 11.989333v84.48c0 2.005333 1.621333 3.669333 3.626666 3.669333a19.029333 19.029333 0 0 0 17.877334-12.501333l27.306666-74.709333 207.104 6.016-38.272 318.762666v1.28c0 2.56 2.048 4.608 4.608 4.608a33.834667 33.834667 0 0 0 30.464-19.114666l145.706667-301.354667 209.664 6.144c25.856 0 46.805333-20.949333 46.805333-46.336v-1.834667a46.805333 46.805333 0 0 0-48.213333-45.397333l-210.261333 6.144-142.976-295.765333-2.261334-4.224a33.834667 33.834667 0 0 0-28.928-16.256z"
          p-id="17597"
        ></path>
      </ControlButton>
      <!-- accessibility -->
      <ControlButton title="Accessibility">
        <path
          d="M385.706667 234.368a128 128 0 1 1 252.544 0.085333l103.765333-38.741333a100.650667 100.650667 0 0 1 75.349333 186.538667L682.666667 440.96v132.693333l80.341333 233.258667a98.816 98.816 0 0 1-186.24 66.090667l-64.64-176.981334-64.512 177.066667a98.986667 98.986667 0 0 1-186.581333-66.133333L341.333333 574.165333v-133.12L200.277333 379.050667A100.266667 100.266667 0 0 1 275.626667 193.28l110.08 41.045333z m62.293333-21.12a64 64 0 0 0 38.229333 58.581333 74.666667 74.666667 0 0 0 50.645334 0.426667A64 64 0 1 0 448 213.205333z m14.08 117.888L253.312 253.269333a36.266667 36.266667 0 0 0-27.306667 67.157334l160.213334 70.528a32 32 0 0 1 19.114666 29.269333v159.36a32 32 0 0 1-1.706666 10.453333L321.493333 827.733333a34.986667 34.986667 0 0 0 65.92 23.424l70.4-193.152c18.474667-50.602667 90.026667-50.645333 108.544 0l70.485334 192.981334a34.816 34.816 0 0 0 65.621333-23.296l-82.090667-238.250667a32.085333 32.085333 0 0 1-1.706666-10.453333V419.968a32 32 0 0 1 19.2-29.354667l153.898666-66.986666a36.650667 36.650667 0 0 0-27.434666-67.925334l-203.946667 76.074667c-14.933333 6.101333-31.274667 9.472-48.426667 9.472a127.573333 127.573333 0 0 1-49.92-10.112z"
          p-id="17630"
        ></path>
      </ControlButton>
      <!-- save-power -->
      <ControlButton title="Battery Saver">
        <path
          d="M469.546667 472.746667c0-67.2-33.92-164.992-100.650667-286.677334-11.477333-20.906667-41.386667-20.608-54.186667-0.853333-17.92 27.562667-44.544 55.765333-80.085333 84.48l-15.786667 12.373333-15.104 11.477334-20.906666 16.085333c-73.770667 58.752-102.826667 111.018667-96.426667 188.245333 5.589333 68.266667 46.890667 117.12 117.845333 139.52-25.045333 29.184-57.984 52.181333-99.157333 69.205334a32 32 0 0 0 24.490667 59.136c78.208-32.384 134.357333-84.309333 166.912-155.008 12.16-26.453333 21.930667-52.522667 29.184-78.250667l1.834666-6.613333 4.352-17.621334 2.901334-14.08 1.792-10.112 2.816-20.352a375.466667 375.466667 0 0 0 2.389333-47.786666l-0.170667-0.981334a32 32 0 0 1 64 0.938667c0.981333 62.293333-11.690667 125.866667-37.802666 190.464l-1.066667 3.797333a19.370667 19.370667 0 0 0 27.050667 21.12l4.864-2.474666c3.114667-1.706667 5.888-3.669333 8.362666-5.802667 30.805333-26.666667 62.549333-82.986667 62.549334-150.186667zM725.333333 256h-224l-4.352 0.298667A32 32 0 0 0 501.333333 320H725.333333l6.186667 0.298667A64 64 0 0 1 789.333333 384v256l-0.298666 6.186667A64 64 0 0 1 725.333333 704H330.666667c-17.322667 1.152-32 13.653333-32 32 0 17.664 14.336 32 32 32H725.333333l7.509334-0.213333A128 128 0 0 0 853.333333 640v-42.666667l42.666667 0.768 5.76-0.426666a42.666667 42.666667 0 0 0 36.949333-42.282667v-85.333333l-0.341333-5.12a42.666667 42.666667 0 0 0-42.325333-37.546667L853.333333 426.666667V384l-0.213333-7.509333A128 128 0 0 0 725.333333 256z"
          p-id="17740"
        ></path>
      </ControlButton>
      <!-- cast -->
      <ControlButton title="Cast">
        <path
          d="M85.333333 266.666667A96 96 0 0 1 181.333333 170.666667h661.333334A96 96 0 0 1 938.666667 266.666667v490.666666A96 96 0 0 1 842.666667 853.333333H181.333333A96 96 0 0 1 85.333333 757.333333V266.666667z m96-32a32 32 0 0 0-32 32v490.666666c0 17.664 14.336 32 32 32h661.333334a32 32 0 0 0 32-32V266.666667a32 32 0 0 0-32-32H181.333333zM298.496 682.453333a42.581333 42.581333 0 1 1-85.162667 0 42.581333 42.581333 0 0 1 85.162667 0zM213.162667 544a32 32 0 0 1 32-32 181.205333 181.205333 0 0 1 181.205333 181.248 32 32 0 0 1-64 0A117.205333 117.205333 0 0 0 245.162667 576a32 32 0 0 1-32-32zM213.162667 415.744a32 32 0 0 1 32-32A309.504 309.504 0 0 1 554.666667 693.248a32 32 0 0 1-64 0 245.504 245.504 0 0 0-245.504-245.504 32 32 0 0 1-32-32z"
          p-id="17905"
        ></path>
      </ControlButton>
    </div>
    <!-- 第三层：控制拉杆 -->
    <div
      @mousemove="handleDragging"
      style="
        width: calc(100% - 30px);
        margin: 15px 0 0 15px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      "
    >
      <SlideCapsule
        :vol="stat.bright"
        v-model:vol="stat.bright"
        @mousedown="startDrag($event, 'bright')"
      >
        <svg
          t="1772027126450"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4990"
          width="20"
          height="20"
        >
          <path
            d="M511.829333 811.093333a32 32 0 0 1 31.701334 27.690667l0.298666 4.352v64a32 32 0 0 1-63.701333 4.309333l-0.298667-4.309333v-64a32 32 0 0 1 32-32z m256.938667-88.405333l45.226667 45.226667a32 32 0 1 1-45.226667 45.269333l-45.226667-45.226667a32 32 0 0 1 45.226667-45.269333z m-468.608 0a32 32 0 0 1 0 45.226667L254.890667 813.226667a32 32 0 0 1-45.226667-45.226667l45.226667-45.269333a32 32 0 0 1 45.226666 0zM512 276.266667a235.733333 235.733333 0 1 1 0 471.466666 235.733333 235.733333 0 0 1 0-471.466666z m0 64a171.733333 171.733333 0 1 0 0 343.466666 171.733333 171.733333 0 0 0 0-343.466666z m394.666667 140.501333a32 32 0 0 1 4.352 63.701333l-4.352 0.298667h-64a32 32 0 0 1-4.352-63.701333l4.352-0.298667h64z m-725.333334-1.237333a32 32 0 0 1 4.352 63.744l-4.352 0.256h-64a32 32 0 0 1-4.352-63.701334l4.352-0.298666h64z m69.973334-271.786667l3.584 3.072 45.226666 45.226667a32 32 0 0 1-41.642666 48.384l-3.584-3.114667-45.226667-45.226667a32 32 0 0 1 41.642667-48.384z m562.688 3.072a32 32 0 0 1 3.114666 41.685333l-3.114666 3.584-45.226667 45.226667a32 32 0 0 1-48.341333-41.642667l3.072-3.584 45.226666-45.269333a32 32 0 0 1 45.269334 0zM512 84.906667a32 32 0 0 1 31.701333 27.648l0.298667 4.352v64a32 32 0 0 1-63.701333 4.309333l-0.298667-4.352v-64a32 32 0 0 1 32-32z"
            p-id="4991"
            fill="currentColor"
          ></path>
        </svg>
      </SlideCapsule>
      <SlideCapsule
        :vol="stat.vol"
        :extra-btn="1"
        v-model:vol="stat.vol"
        @mousedown="startDrag($event, 'vol')"
      >
        <svg
          t="1760701774222"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="11142"
          width="16"
          height="16"
          style="padding: 0 2px"
        >
          <path
            d="M794.752 141.44A489.770667 489.770667 0 0 1 981.333333 526.506667c0 152.170667-69.76 292.928-186.944 385.386666a42.666667 42.666667 0 0 1-52.864-66.986666A404.48 404.48 0 0 0 896 526.528c0-125.632-57.472-241.706667-154.176-318.165333a42.666667 42.666667 0 1 1 52.906667-66.944z m-411.690667 5.333333A106.666667 106.666667 0 0 1 576 209.493333v598.912a106.666667 106.666667 0 0 1-189.952 66.645334l-107.050667-133.824H170.666667a128 128 0 0 1-127.914667-123.2L42.666667 613.226667v-192a128 128 0 0 1 128-128h105.856z m98.816 45.482667a21.333333 21.333333 0 0 0-29.802666 4.693333L339.2 352.213333a64 64 0 0 1-51.776 26.346667H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v192a42.666667 42.666667 0 0 0 42.666667 42.666666h118.570666a64 64 0 0 1 49.984 24.021334l113.450667 141.824A21.333333 21.333333 0 0 0 490.666667 808.405333V209.493333a21.333333 21.333333 0 0 0-8.789334-17.237333z m231.125334 113.365333A297.941333 297.941333 0 0 1 810.666667 526.528c0 85.610667-36.266667 165.504-98.581334 221.738667a42.666667 42.666667 0 0 1-57.173333-63.338667A212.650667 212.650667 0 0 0 725.333333 526.528c0-60.906667-25.6-117.589333-69.76-157.802667a42.666667 42.666667 0 0 1 57.429334-63.104z"
            fill="currentColor"
            p-id="11143"
          ></path>
        </svg>
      </SlideCapsule>
    </div>
  </div>
</template>
<script setup>
import ControlButton from "./control-components/control-button.vue";
import TopButton from "./control-components/top-button.vue";
import SlideCapsule from "./control-components/slide-capsule.vue";
import { ref, reactive } from "vue";
const stat = reactive({
  bright: 50,
  vol: 80,
});

// --- 拖拽逻辑实现 ---
const dragInfo = ref({
  isDragging: false,
  targetKey: null, // 'bright' 或 'vol'
  startX: 0,
  startValue: 0,
});

/**
 * 开始拖拽
 * @param {MouseEvent} e
 * @param {string} key 'bright' | 'vol'
 */
const startDrag = (e, key) => {
  dragInfo.value.isDragging = true;
  dragInfo.value.targetKey = key;
  dragInfo.value.startX = e.clientX;
  dragInfo.value.startValue = stat[key];

  // 防止拖拽过程中选中文本
  e.preventDefault();
};

/**
 * 拖拽中处理
 */
const handleDragging = (e) => {
  if (!dragInfo.value.isDragging) return;

  const { startX, startValue, targetKey } = dragInfo.value;
  const currentX = e.clientX;

  // 计算偏移量
  // 假设整个胶囊宽度大约 300px，你可以调整此处的除数来改变灵敏度
  // 3 表示 3px 移动对应 1% 的变化
  const diff = Math.floor((currentX - startX) / 2);

  let newValue = startValue + diff;

  // 边界约束 0-100
  if (newValue < 0) newValue = 0;
  if (newValue > 100) newValue = 100;

  stat[targetKey] = newValue;
};

/**
 * 停止拖拽
 */
const stopDrag = () => {
  dragInfo.value.isDragging = false;
  dragInfo.value.targetKey = null;
};
</script>
<style scoped>
.control-container {
  position: fixed;
  justify-content: center;
  align-items: center;
  right: 20px;
  bottom: 50px;
  width: 350px;
  height: 350px;
  z-index: 999;
}
.six-flex {
  display: flex;
  flex-direction: row;
  margin: 15px 0 0 15px;
  flex-wrap: wrap;
  gap: 10px;
}
</style>
<style>
.colorful {
  background-color: #f8f8f863;
  transition: all 0.3s ease-in-out;
}
.colorful-open {
  background-color: #0077cc63;
  transition: all 0.3s ease-in-out;
}
.colorful:hover {
  background-color: #ffffff96;
}

.colorful-open:hover {
  background-color: #a8dbffa6;
}
</style>
